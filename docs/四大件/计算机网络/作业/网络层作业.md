# 网络层作业

## 阐述IP协议的作用, 说明IP报文首部结构中各字段的作用

- IP协议的作用: 为上层提供无连接的数据报服务
- IP报文首部结构: ![image-20231110201922374](https://raw.githubusercontent.com/alwaysmissin/picgo/main/image-20231110201922374.png)![image-20231110201958838](https://raw.githubusercontent.com/alwaysmissin/picgo/main/image-20231110201958838.png)
  - 版本(4bit): 规定了数据报的IP协议版本
    - 通过查看版本号, 路由器能够确定如何解释IP数据报的剩余部分
  - 首部长度(4bit): 确定IP数据报中载荷实际开始的地方
    - 由于大多数IP数据报不包含选项字段, 所以一般的IP数据报具有20字节的首部
  - 服务类型(8bit): 区别不同的服务
  - 数据报长度(16bit): IP数据报的总长度
  - 标识(16bit)、标志(3bit)、片偏移(12bit): 与IP分片有关(IPv6不允许在路由器上对分组分片)
  - 生存时间TTL(8bit): 用来确保数据报不会永远在网络中循环
    - 每当一台路由器处理数据报时候, 该字段的值`-1`, 当`TTL==0`时, 该数据报被丢弃
  - 协议(8bit): 指示IP数据报的数据部分应交给哪一个特定的运输层协议(TCP/UDP)处理
    - 仅当一个IP数据报到达其最终目的地时才会被使用
      - `6->TCP`; `17->UDP`
  - 首部校验和: 用于帮助路由器检测接收到的IP数据报中的比特错误
    - 路由器对每个收到的IP数据报计算器首部检验和, 如果数据报首部中携带的检验和与计算得到的检验和不一致, 则检测出是个差错
  - 源和目标IP地址: 当某源生成一个数据报时候, 它会在源IP字段中插入自己的IP地址, 在目标IP字段中插入其最终目的地址
  - 选项: 允许IP首部扩展, 但很少被使用
  - 数据

## IP地址有什么作用? 什么是保留地址? 指出A、B、C三类IP地址各有哪些保留地址

- IP地址的作用: 为每个连接在网络上的主机、路由器或其他设备分配一个在全世界范围内唯一的32位标识符
- 保留地址: 也被称为私有地址, 各独立网络可以重复使用的IP地址, 即网络边界路由器不会像目标地址为这些保留地址的主机转发IP分组(即, 保留地址不会穿越内部网络)
- A、B、C类IP地址中的保留地址:
  - A类: `10.0.0.0`(1个)
  - B类: `172.16.0.0 - 172.31.0.0`(16个)
  - C类: `192.168.0.0 - 192.168.255.0`(256个)

## 某公司有一个C类地址: 192.16.12.0, 请进行网络规划: 划分7个子网, 且每个子网可容纳11台主机

- 从最后8位中划分出7个子网地址
  - $2^2<7<2^3$: 所以选择3位作为子网地址, 可以提供7个子网地址
- 剩余5位, 共可以满足$2^{5}-2=30$个主机的需求, 所以可以满足子网11台主机的需求
- 子网掩码为: 255.255.255.240(11110000)
- 子网地址为32、64、96、....、224

## 已知IP地址: 192.168.23.35/21, 请说明其所属的网络前缀, 并给出该网络前缀所在CIDR地址块的范围

- 所属的网络前缀: `192.168.16.0`
- 范围: `192.168.16.0 - 192.168.23.255`

## 阐述ICMP协议的作用及其报文结构

- ICMP协议的作用: 主机或路由器使用ICMP来发送**差错报告报文**和**查询报文**以沟通网络层的信息
- 报文结构:![image-20231110211717425](https://raw.githubusercontent.com/alwaysmissin/picgo/main/image-20231110211717425.png)

## 在Windows中, 使用tracert可以实现路由追踪目的. 请说明tracert程序获得路由的原理, 以及说明tracert是如何知道发出的探测报文到达目的主机的

- 原理: 
  - 从`TTL=1`开始, tracert不断从源IP向目标IP发出类型为8代码为0的ICMP查询报文, 并主次增加TTL值
  - tracert根据不同TTL值时从各个路由器返回的`TTL=0`的差错报文, 就可以知道经过了哪些路由器
- tracert是如何知道发出的探测报文到达目的主机的? 
  - 当探测报文到达目的主机时，目的主机会发送一个报文回到源主机，告诉源主机这个探测报文已经到达

## IP地址与MAC地址有什么区别

- 功能：
  - IP地址用于在网络中唯一标识一个设备的位置，以便进行数据包的路由和传递。
  - MAC地址则是用于在局域网中唯一标识一个网络设备的物理地址，帮助设备在局域网中进行通信。

- 网络层次：
  - IP地址是网络层（第三层）的地址，用于在全球范围内唯一标识一个设备在网络中的位置。
  - MAC地址是数据链路层（第二层）的地址，用于在局域网内唯一标识一个设备的物理地址。

- 标识范围：
  - IP地址是在互联网上全球唯一的，用于区分不同的设备和网络。
  - MAC地址是在局域网内唯一的，用于在局域网内唯一标识一个设备。

- 格式：
  - IP地址通常以IPv4或IPv6的格式表示
  - MAC地址通常以十六进制表示
- 分配依据
  - MAC地址的分配是基于制造商, 由网络设备制造商生产时写在硬件内部
  - IP地址的分配是基于网络拓扑

## 阐述ARP协议的作用及其报文结构

- ARP协议的作用: 将IP地址转换为MAC地址
- 报文结构![image-20231110213638207](https://raw.githubusercontent.com/alwaysmissin/picgo/main/image-20231110213638207.png)
  - 硬件类型: 发送方硬件接口类型
  - 协议类型: 发送方请求解析的协议地址类型
  - 协议地址长度: 发送方硬件地址长度
  - 协议地址长度: 请求解析的协议地址长度
  - 操作类型: 本报文的类型
    - `1`: ARP请求
    - `2`: ARP响应
    - `3`: RARP请求
    - `4`: RARP响应
  - 发送方硬件地址
  - 发送方IP地址
  - 接收方硬件地址
  - 接收方IP地址

## 禁用主机的ARP协议后, 最直观的现象是什么? 为什么?

- 最直观的现象是无法进行局域网内的正常通信。这是因为ARP（Address Resolution Protocol）在局域网中的重要作用是将IP地址解析为MAC地址，以便设备之间进行通信。

## 免费ARP有什么作用

- **地址冲突检测：** 当设备在网络上启动时，它可能需要检查自己选择的IP地址是否已经被其他设备使用。通过发送免费ARP请求，设备可以检查是否有其他设备响应，从而判断所选择的IP地址是否已经被占用。

- **快速网络恢复：** 在网络出现故障或拓扑变化时，设备可以发送免费ARP消息来通知其他设备更新其ARP缓存。这有助于网络中的其他设备更快地了解到网络拓扑的变化，而不必等待标准ARP请求/响应的周期。

- **IP地址迁移：** 当设备更改其IP地址时，可以发送免费ARP消息来通知网络中的其他设备更新其ARP缓存。这对于设备更改IP地址并希望快速通知其他设备的情况很有用。
