# 运输层
## 概述
> [!note] 
> 物理层, 数据链路层和网络层共同实现了主机到主机的通信.
> 但是在计算机网络中实际进行通信的实体, 是位于通信两端主机中的进程.
> 如何为运行在不同主机上的应用进程提供直接的逻辑通信服务, 就是运输层的主要任务.
> 因此运输层协议又被称为**端到端的协议.**
> ![image.png](https://raw.githubusercontent.com/alwaysmissin/picgo/main/20231107091706.png)
> ![image.png](https://raw.githubusercontent.com/alwaysmissin/picgo/main/20231107091751.png)
- 运输层: 为应用进程间的逻辑通信提供服务
	- 向应用层实体屏蔽了下面网络核心的细节, 使应用进程看见的就好像是在两个运输层实体之间有一条端到端的逻辑通信信道
- 提供了两种不同的运输层协议: 
	- 面向连接的TCP(Transmission Control Protocol)
		- 为上层提供**面向连接的可靠的**数据传输服务
		- 在传输数据之前, 必须**首先建立TCP连接**(逻辑连接, 而非物理连接); 数据传输结束后, 必须要**释放TCP连接**
		- **为了实现可靠传输所采用的措施**: 
			- TCP管理连接
			- 确认机制
			- 超时重传
			- 流量控制
			- 拥塞控制
		- **实现复杂**, 报文段的**首部较大**, **占用的处理机资源较多**
	- 面向无连接的UDP(User Datagram Protocol)
		- 为上层提供**无连接的不可靠**的数据传输服务
		- 传输数据前, 无须建立连接
		- 不需要实现可靠传输的各种机制
		- 实现简单, 首部较小
- 运输层使用端口号实现进程间的通信
	- 端口:![image.png](https://raw.githubusercontent.com/alwaysmissin/picgo/main/20231107092835.png)
		- 熟知端口号(0-1023): 由IANA分配给重要的应用协议
		- 登记端口号(1024-49151): 需要进行登记, 以防重复
		- 短暂端口号(49152-65535): 仅在客户端使用, 通信结束后释放
> [!note] 端口
> 端口号只具有本地意义, 只是为了标识本计算机网络协议栈应用层中的各应用程序.
> 在因特网中, 不同计算机中的相同端口号是没有关系的
> 另外, TCP和UDP端口号之间也是没有关系的

> [!note] 访问过程
> ![image.png](https://raw.githubusercontent.com/alwaysmissin/picgo/main/20231107093401.png)

## TCP与UDP
- 连接过程: ![image.png](https://raw.githubusercontent.com/alwaysmissin/picgo/main/20231107093621.png)
	- TCP需要先建立连接, 后数据传输, 再关闭连接
	- UDP可以直接进行数据传输
- 对单播, 多播和广播的支持: 
	- TCP只支持单播
	- UDP支持单播, 多播和广播
- 应用层报文的处理: ![](https://raw.githubusercontent.com/alwaysmissin/picgo/main/20231107094112.png)
	- TCP是面向字节流的
	- UDP是面向应用报文的
- 对数据传输可靠性的支持情况:
	- TCP会提供无差错的传输
	- UDP不提供任何服务来实现无差错的传输
		- 如果出现丢失或误码的情况, 则直接丢弃
- 首部对比:![image.png](https://raw.githubusercontent.com/alwaysmissin/picgo/main/20231107094400.png)
	- TCP: 20Bytes - 60Bytes
	- UDP: 8Bytes

## 传输控制协议
### TCP报文段的首部格式
- TCP的全部功能实现都需要依赖其首部中的各种字段